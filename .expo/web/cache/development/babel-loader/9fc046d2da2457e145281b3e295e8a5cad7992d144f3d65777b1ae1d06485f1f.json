{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { AuthService } from \"../services/authService\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext(undefined);\nexport var useAuth = function useAuth() {\n  var context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    firebaseUser = _useState4[0],\n    setFirebaseUser = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  useEffect(function () {\n    var unsubscribe = AuthService.onAuthStateChanged(function () {\n      var _ref2 = _asyncToGenerator(function* (firebaseUser) {\n        setFirebaseUser(firebaseUser);\n        if (firebaseUser) {\n          var userData = yield AuthService.getCurrentUserData();\n          setUser(userData);\n          yield AuthService.updateUserStatus(firebaseUser.uid, true);\n        } else {\n          setUser(null);\n        }\n        setLoading(false);\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    return unsubscribe;\n  }, []);\n  useEffect(function () {\n    var handleAppStateChange = function () {\n      var _ref3 = _asyncToGenerator(function* (nextAppState) {\n        if (firebaseUser) {\n          var isOnline = nextAppState === 'active';\n          yield AuthService.updateUserStatus(firebaseUser.uid, isOnline);\n        }\n      });\n      return function handleAppStateChange(_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    var handleVisibilityChange = function () {\n      var _ref4 = _asyncToGenerator(function* () {\n        if (firebaseUser) {\n          var isOnline = !document.hidden;\n          yield AuthService.updateUserStatus(firebaseUser.uid, isOnline);\n        }\n      });\n      return function handleVisibilityChange() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return function () {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [firebaseUser]);\n  var signIn = function () {\n    var _ref5 = _asyncToGenerator(function* (email, password) {\n      try {\n        var userData = yield AuthService.signInWithEmail(email, password);\n        setUser(userData);\n      } catch (error) {\n        console.error('Sign in error:', error);\n        throw error;\n      }\n    });\n    return function signIn(_x3, _x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var signUp = function () {\n    var _ref6 = _asyncToGenerator(function* (email, password, name, phone) {\n      try {\n        var userData = yield AuthService.signUpWithEmail(email, password, name, phone);\n        setUser(userData);\n      } catch (error) {\n        console.error('Sign up error:', error);\n        throw error;\n      }\n    });\n    return function signUp(_x5, _x6, _x7, _x8) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var signOut = function () {\n    var _ref7 = _asyncToGenerator(function* () {\n      try {\n        yield AuthService.signOut();\n        setUser(null);\n        setFirebaseUser(null);\n      } catch (error) {\n        console.error('Sign out error:', error);\n        throw error;\n      }\n    });\n    return function signOut() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var updateProfile = function () {\n    var _ref8 = _asyncToGenerator(function* (updates) {\n      try {\n        if (user) {\n          yield AuthService.updateUserProfile(user.id, updates);\n          setUser(_objectSpread(_objectSpread({}, user), updates));\n        }\n      } catch (error) {\n        console.error('Update profile error:', error);\n        throw error;\n      }\n    });\n    return function updateProfile(_x9) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  var value = {\n    user: user,\n    firebaseUser: firebaseUser,\n    loading: loading,\n    signIn: signIn,\n    signUp: signUp,\n    signOut: signOut,\n    updateProfile: updateProfile\n  };\n  return _jsx(AuthContext.Provider, {\n    value: value,\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","AuthService","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","firebaseUser","setFirebaseUser","_useState5","_useState6","loading","setLoading","unsubscribe","onAuthStateChanged","_ref2","_asyncToGenerator","userData","getCurrentUserData","updateUserStatus","uid","_x","apply","arguments","handleAppStateChange","_ref3","nextAppState","isOnline","_x2","handleVisibilityChange","_ref4","document","hidden","addEventListener","removeEventListener","signIn","_ref5","email","password","signInWithEmail","error","console","_x3","_x4","signUp","_ref6","name","phone","signUpWithEmail","_x5","_x6","_x7","_x8","signOut","_ref7","updateProfile","_ref8","updates","updateUserProfile","id","_objectSpread","_x9","value","Provider"],"sources":["/project/workspace/src/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { User as FirebaseUser } from 'firebase/auth';\nimport { User } from '../types';\nimport { AuthService } from '../services/authService';\n\ninterface AuthContextType {\n  user: User | null;\n  firebaseUser: FirebaseUser | null;\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<void>;\n  signUp: (email: string, password: string, name: string, phone: string) => Promise<void>;\n  signOut: () => Promise<void>;\n  updateProfile: (updates: Partial<User>) => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [firebaseUser, setFirebaseUser] = useState<FirebaseUser | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const unsubscribe = AuthService.onAuthStateChanged(async (firebaseUser) => {\n      setFirebaseUser(firebaseUser);\n      \n      if (firebaseUser) {\n        // Get user data from Firestore\n        const userData = await AuthService.getCurrentUserData();\n        setUser(userData);\n        \n        // Update online status\n        await AuthService.updateUserStatus(firebaseUser.uid, true);\n      } else {\n        setUser(null);\n      }\n      \n      setLoading(false);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  // Handle app state changes for online/offline status\n  useEffect(() => {\n    const handleAppStateChange = async (nextAppState: string) => {\n      if (firebaseUser) {\n        const isOnline = nextAppState === 'active';\n        await AuthService.updateUserStatus(firebaseUser.uid, isOnline);\n      }\n    };\n\n    // Note: In a real React Native app, you'd use AppState from react-native\n    // For now, we'll handle visibility change for web\n    const handleVisibilityChange = async () => {\n      if (firebaseUser) {\n        const isOnline = !document.hidden;\n        await AuthService.updateUserStatus(firebaseUser.uid, isOnline);\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [firebaseUser]);\n\n  const signIn = async (email: string, password: string) => {\n    try {\n      const userData = await AuthService.signInWithEmail(email, password);\n      setUser(userData);\n    } catch (error) {\n      console.error('Sign in error:', error);\n      throw error;\n    }\n  };\n\n  const signUp = async (email: string, password: string, name: string, phone: string) => {\n    try {\n      const userData = await AuthService.signUpWithEmail(email, password, name, phone);\n      setUser(userData);\n    } catch (error) {\n      console.error('Sign up error:', error);\n      throw error;\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      await AuthService.signOut();\n      setUser(null);\n      setFirebaseUser(null);\n    } catch (error) {\n      console.error('Sign out error:', error);\n      throw error;\n    }\n  };\n\n  const updateProfile = async (updates: Partial<User>) => {\n    try {\n      if (user) {\n        await AuthService.updateUserProfile(user.id, updates);\n        setUser({ ...user, ...updates });\n      }\n    } catch (error) {\n      console.error('Update profile error:', error);\n      throw error;\n    }\n  };\n\n  const value: AuthContextType = {\n    user,\n    firebaseUser,\n    loading,\n    signIn,\n    signUp,\n    signOut,\n    updateProfile,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}